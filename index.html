<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FamilyBoard ‚Äì Napi teend≈ëk napt√°r szerint</title>
  <style>
    :root{
      --primary:#0ea5e9;
      --bg:#f6f8fb;
      --card:#fff;
      --text:#222;
      --muted:#6b7280;
      --border:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica Neue,Arial;
      background:var(--bg); color:var(--text);
      display:flex; flex-direction:column; align-items:center; min-height:100vh;
    }
    header{width:100%; background:var(--primary); color:#fff; padding:14px 16px; text-align:center; font-size:20px; font-weight:700}
    main{width:min(900px,92vw); margin:18px auto; display:grid; gap:16px; grid-template-columns:1fr; }
    @media (min-width:900px){ main{ grid-template-columns: 1.1fr 1fr; } }
    .card{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px; box-shadow:0 6px 24px rgba(0,0,0,.05)}
    h2{margin:0 0 10px; font-size:18px}
    .muted{color:var(--muted)}
    .row{display:flex; gap:8px; align-items:center}
    .right{margin-left:auto}
    button{cursor:pointer; border:none; background:var(--primary); color:#fff; padding:8px 12px; border-radius:10px; font-weight:600}
    button.ghost{background:transparent; color:var(--primary); border:1px solid var(--primary)}
    input[type="text"]{flex:1; padding:10px 12px; border-radius:10px; border:1px solid var(--border); font-size:15px}
    .kpi{font-size:13px; color:var(--muted)}
    /* Calendar */
    .cal-head{display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
    .cal-head h3{margin:0; font-size:16px}
    .cal-grid{display:grid; grid-template-columns:repeat(7,1fr); gap:4px}
    .dow{font-size:12px; text-align:center; color:var(--muted); padding:6px 0}
    .day{
      position:relative; background:#fff; border:1px solid var(--border); border-radius:10px;
      padding:10px; text-align:right; min-height:52px; font-weight:600; color:#111;
    }
    .day.out{color:#bbb; background:#fafafa}
    .day.selected{outline:2px solid var(--primary); box-shadow:0 0 0 3px rgba(14,165,233,.15)}
    .dot{position:absolute; left:8px; bottom:6px; width:8px; height:8px; border-radius:50%; background:var(--primary)}
    .count{position:absolute; left:6px; top:6px; font-size:11px; color:#fff; background:var(--primary); padding:2px 6px; border-radius:999px}
    /* Tasks */
    ul{list-style:none; margin:10px 0 0; padding:0}
    li.task{display:flex; align-items:center; gap:10px; border-bottom:1px solid var(--border); padding:8px 4px}
    li.task:last-child{border-bottom:none}
    li.task.done span{ text-decoration: line-through; color:#9ca3af }
    .tiny{font-size:12px; color:var(--muted)}
    .actions{display:flex; gap:6px}
  </style>
</head>
<body>
  <header>üìÖ FamilyBoard ‚Äì napi teend≈ëk</header>

  <main>
    <!-- Calendar -->
    <section class="card">
      <div class="cal-head">
        <div class="row">
          <button id="prev" class="ghost">‚óÄ</button>
          <button id="todayBtn" class="ghost">Ma</button>
          <button id="next" class="ghost">‚ñ∂</button>
        </div>
        <h3 id="monthLabel">2025. okt√≥ber</h3>
        <input type="date" id="datePicker" />
      </div>
      <div class="cal-grid" id="calGrid">
        <!-- DOW -->
      </div>
      <p class="tiny">Tipp: kattints egy napra, hogy arra a d√°tumra r√∂gz√≠ts teend≈ëket.</p>
    </section>

    <!-- Tasks for selected date -->
    <section class="card">
      <h2 id="dayTitle">Teend≈ëk ‚Äì <span class="muted" id="dateOut">-</span></h2>
      <div class="row" style="margin-bottom:8px">
        <input type="text" id="taskInput" placeholder="√öj teend≈ë a kiv√°lasztott napra..." />
        <button id="addBtn">Hozz√°ad√°s</button>
      </div>
      <div class="row kpi">
        <span id="kpi"></span>
        <span class="right">
          <button id="clearDone" class="ghost">K√©sz teend≈ëk t√∂rl√©se</button>
        </span>
      </div>
      <ul id="list"></ul>
    </section>
  </main>

  <script>
    // --- Data model in localStorage ---
    // tasksByDate: { "YYYY-MM-DD": [{id,text,done}], ... }
    const LS_KEY = 'familyboard_tasksByDate_v1';
    const $ = sel => document.querySelector(sel);
    const calGrid = $('#calGrid');
    const monthLabel = $('#monthLabel');
    const datePicker = $('#datePicker');
    const prevBtn = $('#prev'), nextBtn = $('#next'), todayBtn = $('#todayBtn');

    const list = $('#list');
    const input = $('#taskInput');
    const addBtn = $('#addBtn');
    const kpi = $('#kpi');
    const clearDoneBtn = $('#clearDone');
    const dateOut = $('#dateOut');

    const DOW = ['H','K','Sze','Cs','P','Szo','V'];

    let tasksByDate = readLS(LS_KEY, {});
    let view = today(); // month in view (YYYY-MM-01)
    let selected = today(); // selected date YYYY-MM-DD

    // ---- Utilities ----
    function readLS(key, fallback){
      try{ return JSON.parse(localStorage.getItem(key)) ?? fallback }catch{ return fallback }
    }
    function writeLS(){ localStorage.setItem(LS_KEY, JSON.stringify(tasksByDate)) }
    function pad(n){ return String(n).padStart(2,'0') }
    function today(){
      const d = new Date();
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    }
    function ymdOf(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`}
    function firstOfMonth(ymd){
      const [y,m] = ymd.split('-').map(Number);
      return new Date(y, m-1, 1);
    }
    function addMonths(ymd, n){
      const [y,m] = ymd.split('-').map(Number);
      const d = new Date(y, m-1+n, 1);
      return ymdOf(new Date(d.getFullYear(), d.getMonth(), 1));
    }
    function fmtMonth(d){
      const y = d.getFullYear(); const m = d.toLocaleString('hu-HU',{month:'long'});
      return `${y}. ${m}`;
    }
    function uuid(){ return (crypto&&crypto.randomUUID) ? crypto.randomUUID() : 'id_'+Math.random().toString(36).slice(2) }

    // ---- Calendar render ----
    function renderCalendar(){
      // header row with DOW
      calGrid.innerHTML = '';
      for(const w of DOW){
        const el = document.createElement('div');
        el.className = 'dow';
        el.textContent = w;
        calGrid.appendChild(el);
      }
      const first = firstOfMonth(view);
      monthLabel.textContent = fmtMonth(first);

      // Determine grid range (start from Monday)
      const start = new Date(first);
      const shift = (start.getDay() + 6) % 7; // Mon=0 ... Sun=6
      start.setDate(start.getDate() - shift);
      // 6 weeks grid (42 days)
      for(let i=0;i<42;i++){
        const d = new Date(start);
        d.setDate(start.getDate()+i);
        const ymd = ymdOf(d);
        const cell = document.createElement('button');
        cell.type = 'button';
        cell.className = 'day';
        // mark days out of current month
        if (d.getMonth() !== first.getMonth()) cell.classList.add('out');
        cell.textContent = d.getDate();

        // highlights
        if (ymd === selected) cell.classList.add('selected');
        const tasks = tasksByDate[ymd] || [];
        const doneCount = tasks.filter(t=>t.done).length;
        if (tasks.length){
          const dot = document.createElement('div'); dot.className='dot';
          cell.appendChild(dot);
          const c = document.createElement('div'); c.className='count'; c.textContent = tasks.length - doneCount;
          if (doneCount === tasks.length) c.textContent = '‚úì';
          cell.appendChild(c);
        }

        cell.addEventListener('click', ()=>{
          selected = ymd;
          datePicker.value = selected;
          renderCalendar();
          renderTasks();
        });
        calGrid.appendChild(cell);
      }
      // update datePicker to currently selected
      datePicker.value = selected;
    }

    // ---- Tasks render ----
    function renderTasks(){
      const arr = tasksByDate[selected] || [];
      dateOut.textContent = selected;
      list.innerHTML = '';
      if (!arr.length){
        const p = document.createElement('p');
        p.className = 'muted';
        p.textContent = 'Nincs teend≈ë ezen a napon.';
        list.appendChild(p);
      } else {
        arr.forEach((t, idx)=>{
          const li = document.createElement('li');
          li.className = 'task' + (t.done ? ' done' : '');
          const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = t.done;
          cb.onchange = ()=>{ t.done = !t.done; save(); };
          const span = document.createElement('span'); span.textContent = t.text;
          const del = document.createElement('button'); del.textContent='üóëÔ∏è'; del.className='ghost';
          del.onclick = ()=>{ arr.splice(idx,1); save(); };
          li.append(cb, span, del);
          list.appendChild(li);
        });
      }
      const total = arr.length;
      const done = arr.filter(t=>t.done).length;
      kpi.textContent = total ? `K√©sz: ${done}/${total}` : '‚Äî';
    }

    function save(){
      writeLS();
      renderTasks();
      renderCalendar();
    }

    // ---- Events ----
    addBtn.onclick = ()=>{
      const text = input.value.trim();
      if(!text) return;
      const arr = tasksByDate[selected] || (tasksByDate[selected] = []);
      arr.push({ id: uuid(), text, done:false });
      input.value = '';
      save();
    };
    input.addEventListener('keydown', e=> { if(e.key==='Enter') addBtn.click(); });

    clearDoneBtn.onclick = ()=>{
      const arr = tasksByDate[selected] || [];
      tasksByDate[selected] = arr.filter(t=>!t.done);
      save();
    };

    prevBtn.onclick = ()=>{ view = addMonths(view, -1); renderCalendar(); };
    nextBtn.onclick = ()=>{ view = addMonths(view, 1); renderCalendar(); };
    todayBtn.onclick = ()=>{ selected = today(); view = selected.slice(0,7)+'-01'; renderCalendar(); renderTasks(); };
    datePicker.onchange = ()=>{
      if (!datePicker.value) return;
      selected = datePicker.value;
      view = selected.slice(0,7)+'-01';
      renderCalendar(); renderTasks();
    };

    // ---- Boot ----
    // migrate old (optional): if you used earlier version with 'familyboard_tasks' array
    try{
      const legacy = JSON.parse(localStorage.getItem('familyboard_tasks')||'null');
      if(Array.isArray(legacy) && legacy.length){
        const d=today();
        tasksByDate[d] = (tasksByDate[d]||[]).concat(legacy.map(x=>({id:uuid(), text:x.text||x, done:!!x.done})));
        localStorage.removeItem('familyboard_tasks');
        writeLS();
      }
    }catch{}
    // init view to month of selected
    view = selected.slice(0,7)+'-01';
    renderCalendar();
    renderTasks();
  </script>
</body>
</html>
