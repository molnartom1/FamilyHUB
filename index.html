<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FamilyHub • Napi Kör — Családi PWA</title>
  <meta name="description" content="Családi irányítópult + közös naptár, offline-first PWA, opcionális Google Calendar szinkronhoz előkészítve." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Ccircle cx='64' cy='64' r='60' fill='%230bb'/%3E%3Cpath d='M32 72c8-20 56-20 64 0-4 20-60 20-64 0z' fill='%23fff'/%3E%3Ccircle cx='48' cy='52' r='8' fill='%23fff'/%3E%3Ccircle cx='80' cy='52' r='8' fill='%23fff'/%3E%3C/svg%3E" />
  <style>
    body { font-family: system-ui, sans-serif; background: #0b1020; color: #e6eefb; margin: 0; }
    main { max-width: 800px; margin: auto; padding: 1rem; }
    header { background: #121a2f; padding: 1rem; text-align: center; }
    .btn { background: #1a2442; color: white; border: 1px solid #2a3a62; border-radius: 8px; padding: 0.5rem 1rem; cursor: pointer; }
    .hidden { display: none; }
    .toast { position: fixed; bottom: 16px; right: 16px; background: #0f1730; border: 1px solid #27406b; padding: 10px 14px; border-radius: 12px; }
  </style>
</head>
<body>
  <header>
    <h1>FamilyHub • Napi Kör</h1>
    <p>Offline-first PWA + Google Calendar szinkron (beta)</p>
    <button id="installBtn" class="btn">Telepítés (PWA)</button>
    <button id="testSW" class="btn">SW teszt</button>
  </header>
  <main>
    <h2>Üdv, Család!</h2>
    <p>Ez a FamilyHub új, stabil verziója. Támogatja a GitHub Pages-t, a Service Worker offline működést és a helyi értesítéseket.</p>
  </main>
  <div id="toast" class="toast hidden"></div>
  <script>
    const toast = (msg) => {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.remove('hidden');
      setTimeout(() => t.classList.add('hidden'), 3000);
    };

    function registerPWA() {
      const isSandbox = ['blob:', 'file:'].includes(location.protocol) || location.origin === 'null';
      const BASE = isSandbox ? '/' : (location.pathname.endsWith('/') ? location.pathname : location.pathname.replace(/[^/]+$/, ''));

      const manifest = {
        name: 'FamilyHub • Napi Kör', short_name: 'FamilyHub', start_url: BASE, scope: BASE, display: 'standalone', background_color: '#0b1020', theme_color: '#0b1020',
        icons: [192,512].map(sz => ({ src: 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><circle cx=%2264%22 cy=%2264%22 r=%2260%22 fill=%22%230bb%22/></svg>', sizes: `${sz}x${sz}`, type: 'image/png' }))
      };
      const blob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('link');
      link.rel = 'manifest';
      link.href = url;
      document.head.appendChild(link);

      if (isSandbox) {
        console.warn('Sandbox (blob/file) environment – SW disabled');
        toast('Vászon módban az SW kikapcsolva — ez normális.');
        return;
      }

      if ('serviceWorker' in navigator) {
        const swURL = new URL('sw.js', location.origin + BASE).toString();
        navigator.serviceWorker.register(swURL, { scope: BASE })
          .then(r => toast('SW reg OK: ' + r.scope))
          .catch(err => {
            console.error('SW reg error', err);
            toast('SW reg hiba: ellenőrizd, hogy a sw.js a repo-ban van-e.');
          });
      }
    }

    async function testSW() {
      if (!('serviceWorker' in navigator)) return toast('Nincs SW támogatás.');
      const regs = await navigator.serviceWorker.getRegistrations();
      if (!regs.length) return toast('Nem található SW regisztráció.');
      toast('SW aktív: ' + regs.map(r => r.scope).join(', '));
    }

    document.getElementById('installBtn').onclick = registerPWA;
    document.getElementById('testSW').onclick = testSW;
  </script>
</body>
</html>
