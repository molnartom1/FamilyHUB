<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <!-- iPhone 12 mini optimal: -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#0ea5e9">
  <title>FamilyBoard ‚Äì PWA iPhone 12 mini</title>
  <style>
    :root{
      --primary:#0ea5e9; --bg:#f6f8fb; --card:#fff; --text:#222; --muted:#6b7280; --border:#e5e7eb;
      /* iOS safe-area fallbacks: */
      --inset-top: env(safe-area-inset-top, 0px);
      --inset-right: env(safe-area-inset-right, 0px);
      --inset-bottom: env(safe-area-inset-bottom, 0px);
      --inset-left: env(safe-area-inset-left, 0px);
    }
    /* No side-scroll, full width */
    html, body{
      width:100%;
      max-width:100%;
      overflow-x:hidden; /* NE CS√öSZK√ÅLJON JOBBRA-BALRA */
      margin:0; padding:0;
      -webkit-text-size-adjust:100%;
      box-sizing:border-box;
      background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    *, *::before, *::after { box-sizing: inherit; }
    /* Mobile touch polish */
    body{
      min-height:100dvh; /* modern mobil viewport egys√©g */
      padding-left: calc(8px + var(--inset-left));
      padding-right: calc(8px + var(--inset-right));
      touch-action: manipulation;
      -webkit-overflow-scrolling: touch;
    }
    header{
      position:sticky; top:0; z-index:10;
      background:var(--primary); color:#fff;
      padding: calc(8px + var(--inset-top)) 12px 8px 12px;
      margin-left: calc(-8px - var(--inset-left));
      margin-right: calc(-8px - var(--inset-right));
      text-align:center; font-size:18px; font-weight:700;
    }
    main{
      width:100%;
      max-width: 950px;
      margin: 14px auto;
      display:grid; gap:12px; grid-template-columns:1fr;
    }
    @media (min-width:900px){ main{ grid-template-columns: 1.2fr 1fr; } }
    .card{
      background:var(--card); border:1px solid var(--border);
      border-radius:14px; padding:12px;
      box-shadow:0 6px 24px rgba(0,0,0,.05);
      overflow:hidden; /* ne l√≥gjon ki semmi */
    }
    h2{margin:0 0 8px; font-size:17px}
    .muted{color:var(--muted)}
    .row{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .right{margin-left:auto}
    button{
      cursor:pointer; border:none; background:var(--primary); color:#fff;
      padding:10px 12px; border-radius:10px; font-weight:600; font-size:16px; /* 16px -> iOS no-zoom */
    }
    button.ghost{background:transparent; color:var(--primary); border:1px solid var(--primary)}
    input[type="text"], input[type="password"], input[type="time"], input[type="number"]{
      padding:12px; border-radius:10px; border:1px solid var(--border); font-size:16px; /* 16px -> iOS no-zoom */
      min-width: 0; /* flex shrink ok */
    }
    input[type="text"]{flex:1}
    ul{list-style:none; margin:8px 0 0; padding:0}
    li.item{
      display:flex; align-items:center; gap:10px;
      border-bottom:1px solid var(--border); padding:8px 4px;
      min-width:0; /* hossz√∫ sz√∂veg t√∂rj√∂n */
    }
    li.item:last-child{border-bottom:none}
    li.item.done span.txt{ text-decoration: line-through; color:#9ca3af }
    .txt{overflow:hidden; text-overflow:ellipsis; white-space:nowrap; flex:1}
    .badge-time{
      font-size:12px; background:#0ea5e91a; color:#0369a1; border:1px solid #bae6fd;
      padding:3px 8px; border-radius:999px; flex:0 0 auto;
    }
    /* Calendar */
    .cal-head{display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
    .cal-head h3{margin:0; font-size:16px}
    .cal-grid{display:grid; grid-template-columns:repeat(7,1fr); gap:4px}
    .dow{font-size:12px; text-align:center; color:var(--muted); padding:6px 0}
    .day{
      position:relative; background:#fff; border:1px solid var(--border); border-radius:10px;
      padding:10px; text-align:right; min-height:52px; font-weight:600; color:#111; overflow:hidden;
    }
    .day.out{color:#bbb; background:#fafafa}
    .day.selected{outline:2px solid var(--primary); box-shadow:0 0 0 3px rgba(14,165,233,.15)}
    .count{position:absolute; left:6px; top:6px; font-size:11px; color:#fff; background:var(--primary); padding:2px 6px; border-radius:999px}
    /* Footer safe area padding (home indicator z√≥na) */
    .footer-pad{
      height: calc(8px + var(--inset-bottom));
      margin-left: calc(-8px - var(--inset-left));
      margin-right: calc(-8px - var(--inset-right));
    }
  </style>
</head>
<body>
  <header>üì± FamilyBoard ‚Äì iPhone 12 mini PWA</header>

  <main>
    <!-- BAL: napt√°r + napi teend≈ëk -->
    <section>
      <div class="card">
        <div class="cal-head">
          <button id="prev" class="ghost">‚óÄ</button>
          <h3 id="monthLabel">2025. okt√≥ber</h3>
          <button id="next" class="ghost">‚ñ∂</button>
        </div>
        <div class="cal-grid" id="calGrid"></div>
      </div>

      <div class="card" style="margin-top:12px">
        <h2>Teend≈ëk ‚Äì <span id="dateOut" class="muted">-</span></h2>
        <div class="row" style="margin-bottom:8px">
          <input type="text" id="taskInput" placeholder="√öj teend≈ë..." />
          <input type="time" id="taskTime" aria-label="Id≈ëpont (√≥ra:perc)" />
          <button id="addTask">Hozz√°ad√°s</button>
        </div>
        <ul id="taskList"></ul>
        <div class="row" style="margin-top:8px">
          <span class="muted">Id≈ë szerinti rendez√©s ‚Ä¢ √ºres id≈ë = lista v√©ge</span>
          <button id="clearDone" class="ghost right">K√©sz teend≈ëk t√∂rl√©se</button>
        </div>
      </div>
    </section>

    <!-- JOBB: bev√°s√°rl√≥lista -->
    <section>
      <div class="card">
        <h2>üõí Bev√°s√°rl√≥lista</h2>
        <div class="row" style="margin-bottom:8px">
          <input type="text" id="shopInput" placeholder="√öj t√©tel..." />
          <button id="addItem">Hozz√°ad√°s</button>
        </div>
        <ul id="shopList"></ul>
        <p class="muted">T√∂rl√©shez PIN sz√ºks√©ges (2025).</p>
      </div>
    </section>
  </main>

  <!-- iOS home indicator safe area filler -->
  <div class="footer-pad"></div>

  <script>
    /* ===== PIN a t√∂rl√©sekhez ===== */
    const PIN = "2025";
    const requirePin = (msg="PIN sz√ºks√©ges a m≈±velethez") => prompt(msg) === PIN;

    /* ===== Seg√©dek ===== */
    const $ = s => document.querySelector(s);
    const pad = n => String(n).padStart(2,"0");
    const ymdOf = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    const today = () => ymdOf(new Date());
    const DOW = ['H','K','Sze','Cs','P','Szo','V'];
    const validTime = t => /^([01]\d|2[0-3]):[0-5]\d$/.test(t);
    const load = (k,f)=>{ try{return JSON.parse(localStorage.getItem(k)) ?? f}catch{return f} };
    const save = (k,v)=> localStorage.setItem(k, JSON.stringify(v));
    const uuid = ()=> crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(36).slice(2);

    /* ===== Adatok ===== */
    let tasksByDate = load('fb_tasks_v2', {});   // { "YYYY-MM-DD": [ {id,text,done,time?} ] }
    let shopping    = load('fb_shopping', []);   // [ {id,text,done} ]
    let selected = today();
    let viewMonth = selected.slice(0,7)+'-01';

    /* ===== Napt√°r ===== */
    const calGrid = $('#calGrid'), monthLabel=$('#monthLabel');
    const renderCalendar = ()=>{
      calGrid.innerHTML='';
      DOW.forEach(d=>{const el=document.createElement('div');el.className='dow';el.textContent=d;calGrid.appendChild(el);});
      const [y,m]=viewMonth.split('-').map(Number);
      const first=new Date(y,m-1,1);
      monthLabel.textContent=`${y}. ${first.toLocaleString('hu-HU',{month:'long'})}`;
      const start=new Date(first);
      const shift=(start.getDay()+6)%7; start.setDate(start.getDate()-shift);
      for(let i=0;i<42;i++){
        const d=new Date(start); d.setDate(start.getDate()+i);
        const ymd=ymdOf(d);
        const cell=document.createElement('button'); cell.className='day'; cell.textContent=d.getDate();
        cell.type='button';
        if(d.getMonth()!==first.getMonth())cell.classList.add('out');
        if(ymd===selected)cell.classList.add('selected');
        const arr=(tasksByDate[ymd]||[]);
        if(arr.length){
          const pending = arr.filter(x=>!x.done).length;
          const c=document.createElement('div'); c.className='count'; c.textContent = pending===0 ? '‚úì' : pending;
          cell.appendChild(c);
        }
        cell.onclick=()=>{ selected=ymd; renderCalendar(); renderTasks(); };
        calGrid.appendChild(cell);
      }
    };
    const moveMonth = (offset)=>{
      const [y,m]=viewMonth.split('-').map(Number);
      const d=new Date(y,m-1+offset,1);
      viewMonth = ymdOf(new Date(d.getFullYear(), d.getMonth(), 1));
      renderCalendar();
    };
    $('#prev').onclick = ()=> moveMonth(-1);
    $('#next').onclick = ()=> moveMonth(1);

    /* ===== Teend≈ëk ===== */
    const list=$('#taskList'), ti=$('#taskInput'), tt=$('#taskTime'), addTask=$('#addTask'), dateOut=$('#dateOut'), clearDoneBtn=$('#clearDone');
    const timeToMinutes = t => (!t || !validTime(t)) ? 1e9 : (t.split(':').map(Number)[0]*60 + t.split(':').map(Number)[1]);

    const renderTasks = ()=>{
      dateOut.textContent=selected;
      const arr=(tasksByDate[selected]||[]).slice().sort((a,b)=> timeToMinutes(a.time)-timeToMinutes(b.time));
      list.innerHTML='';
      if(!arr.length){ const p=document.createElement('p'); p.textContent='Nincs teend≈ë.'; p.className='muted'; list.appendChild(p); return; }
      for(const t of arr){
        const li=document.createElement('li'); li.className='item'+(t.done?' done':'');
        const cb=document.createElement('input'); cb.type='checkbox'; cb.checked=t.done;
        cb.onchange=()=>{ t.done=!t.done; commitTask(t); };
        const time=document.createElement('span'); time.className='badge-time'; time.textContent = t.time ? `üïí ${t.time}` : '‚Äî';
        const edit=document.createElement('button'); edit.textContent='‚úèÔ∏è'; edit.className='ghost';
        edit.onclick=()=>{
          const nv = prompt('Id≈ë (HH:MM, √ºres = nincs)', t.time || '');
          if(nv===null) return; if(nv!=='' && !validTime(nv)){ alert('√ârv√©nytelen id≈ë.'); return; }
          t.time = nv; commitTask(t);
        };
        const txt=document.createElement('span'); txt.className='txt'; txt.textContent=t.text;
        const right=document.createElement('span'); right.className='right';
        const del=document.createElement('button'); del.className='ghost'; del.textContent='üóëÔ∏è';
        del.onclick=()=>{ if(!requirePin()) return; removeTask(t.id); };
        li.append(cb, time, edit, txt, right, del);
        list.appendChild(li);
      }
    };
    const commitTask = (task)=>{
      const arr=tasksByDate[selected]||[]; const i=arr.findIndex(x=>x.id===task.id);
      if(i>-1) arr[i]=task; save('fb_tasks_v2', tasksByDate); renderTasks(); renderCalendar();
    };
    const removeTask = (id)=>{
      const arr=tasksByDate[selected]||[]; const i=arr.findIndex(x=>x.id===id);
      if(i>-1) arr.splice(i,1); save('fb_tasks_v2', tasksByDate); renderTasks(); renderCalendar();
    };
    addTask.onclick=()=>{
      const text=ti.value.trim(); let time=tt.value.trim();
      if(!text) return; if(time && !validTime(time)) { alert('√ârv√©nytelen id≈ë (HH:MM)'); return; }
      const arr=tasksByDate[selected]||(tasksByDate[selected]=[]);
      arr.push({id:uuid(), text, done:false, time: time||""});
      ti.value=''; tt.value=''; save('fb_tasks_v2', tasksByDate); renderTasks(); renderCalendar();
    };
    ti.onkeydown=e=>{ if(e.key==='Enter') addTask.click(); };
    tt.onkeydown=e=>{ if(e.key==='Enter') addTask.click(); };
    clearDoneBtn.onclick=()=>{
      if(!requirePin()) return;
      const arr=tasksByDate[selected]||[]; tasksByDate[selected]=arr.filter(t=>!t.done);
      save('fb_tasks_v2', tasksByDate); renderTasks(); renderCalendar();
    };

    /* ===== Bev√°s√°rl√≥lista ===== */
    const shopInput=$('#shopInput'), addItem=$('#addItem'), shopList=$('#shopList');
    const renderShopping=()=>{
      shopList.innerHTML='';
      if(!shopping.length){ const p=document.createElement('p'); p.textContent='√úres bev√°s√°rl√≥lista.'; p.className='muted'; shopList.appendChild(p); return; }
      shopping.forEach((i,idx)=>{
        const li=document.createElement('li'); li.className='item'+(i.done?' done':'');
        const cb=document.createElement('input'); cb.type='checkbox'; cb.checked=i.done;
        cb.onchange=()=>{ i.done=!i.done; save('fb_shopping',shopping); renderShopping(); };
        const txt=document.createElement('span'); txt.className='txt'; txt.textContent=i.text;
        const del=document.createElement('button'); del.textContent='üóëÔ∏è'; del.className='ghost';
        del.onclick=()=>{ if(!requirePin()) return; shopping.splice(idx,1); save('fb_shopping',shopping); renderShopping(); };
        li.append(cb, txt, del); shopList.appendChild(li);
      });
    };
    addItem.onclick=()=>{
      const text=shopInput.value.trim(); if(!text) return;
      shopping.push({id:uuid(), text, done:false}); shopInput.value='';
      save('fb_shopping', shopping); renderShopping();
    };
    shopInput.onkeydown=e=>{ if(e.key==='Enter') addItem.click(); };

    /* ===== Init ===== */
    renderCalendar(); renderTasks(); renderShopping();

    /* ===== (Opci√≥s) PWA SW regisztr√°ci√≥ ‚Äì ha k√©s≈ëbb beraksz sw.js-t =====
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(()=>{});
      });
    }
    */
  </script>
</body>
</html>
